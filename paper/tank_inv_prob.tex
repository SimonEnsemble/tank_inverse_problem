%% Author_tex.tex
%% V1.0
%% 2012/13/12
%% developed by Techset
%%
%% This file describes the coding for rsproca.cls

\documentclass[openacc]{rsproca_new}%%%%where rsproca is the template name
\usepackage{subcaption}
\usepackage[thinc]{esdiff} % for derivatives
\usepackage{empheq} % boxed equations
\usepackage{amsmath}

\definecolor{myboxcolor}{rgb}{0.96, 0.96, 0.96}
\newcommand*\mybox[1]{%
\colorbox{myboxcolor}{\hspace{1em}#1\hspace{1em}}}

\usepackage{xspace}
\newcommand\thedata {$\{(t_i,h_{\text{obs}, i})\}_{i=1}^{N}$\xspace}
\newcommand\thedatanomath {\{(t_i,h_{\text{obs}, i})\}_{i=1}^{N}}
\newcommand\themodel {$h(t; h_0, \boldsymbol \alpha, \boldsymbol\theta)$\xspace}
\newcommand\themodelnomath {h(t; h_0, \boldsymbol \alpha, \boldsymbol\theta)}

% from empheq pkg
\definecolor{shadecolor}{rgb}{0.97, 0.97, 1.0}
\definecolor{titlecolor}{rgb}{0.96, 1.0, 0.98}
\newsavebox{\mysaveboxM} % M for math
\newsavebox{\mysaveboxT} % T for text
\newcommand*\Garybox[2][Example]{%
\sbox{\mysaveboxM}{#2}%
\sbox{\mysaveboxT}{\fcolorbox{black}{titlecolor}{#1}}%
\sbox{\mysaveboxM}{%
\fcolorbox{black}{shadecolor}{%
\makebox[\linewidth-10em]{\usebox{\mysaveboxM}}%
}%
}%
\usebox{\mysaveboxM}%
\makebox[0pt][r]{%
\makebox[\wd\mysaveboxM][c]{%
\raisebox{\ht\mysaveboxM-0.5\ht\mysaveboxT
+1.6\dp\mysaveboxT-0.5\fboxrule}{\usebox{\mysaveboxT}}%
}%
}%
}


\usepackage{tcolorbox} 
\tcbuselibrary{breakable}
\newtcolorbox[auto counter
]{mytcbox}[2][]{
% title=Box~\thetcbcounter: #2,#1,
title=Box: #2, #1,
colback=white,
colframe=black,
fonttitle=\bfseries,
parbox=false
}


%%%% *** Do not adjust lengths that control margins, column widths, etc. ***

%%%%%%%%%%% Defining Enunciations  %%%%%%%%%%%
\newtheorem{theorem}{\bf Theorem}[section]
\newtheorem{condition}{\bf Condition}[section]
\newtheorem{corollary}{\bf Corollary}[section]
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% Please insert respective article type here %%%%
\titlehead{Research}

\begin{document}

%%%% Article title to be placed here
\title{Bayesian inference of the shape of an object inside of a gravity-drained tank}

\author{%%%% Author details
Gbenga Fabusola$^{1}$, 
Cory M. Simon$^{1}$
}

%%%%%%%%% Insert author address here
\address{$^{1}$School of Chemical, Biological, and Environmental Engineering. Oregon State University. Corvallis, OR, USA.
% $^{2}$Second author address\\
}

%%%% Subject entries to be placed here %%%%
\subject{applied mathematics, chemical engineering}

%%%% Keyword entries to be placed here %%%%
\keywords{inverse problems, Bayesian statistical inversion, Torricelli's law}

%%%% Insert corresponding author and its email address}
\corres{Cory M. Simon\\
\email{cory.simon@oregonstate.edu}}

%%%% Abstract text to be placed here %%%%%%%%%%%%
\begin{abstract}
In engineering, we often encounter an open-top, liquid-holding tank that is draining via gravity-driven flow through a small orifice in its side. 
Torricelli's law and a mass balance give a differential equation model governing the liquid level in the tank over time. 
Herein, we consider the reconstruction inverse problem of using this model to infer the shape of a solid, heavy object inside the draining tank from measurements of the liquid level over time. (Intuitively, the tank will drain faster if an object inside the tank displaces liquid.) To quantify uncertainty about the shape of the object and incorporate prior information, we employ Bayesian statistical inversion to tackle this reconstruction problem. 

In our experimental setup, a small, open-top tank (an inverted, truncated cone with a rounded rectangle base) drains of water through a small orifice in its side; a liquid level strip collects time series data of the water level. 
First, we calibrate and test our forward model of the dynamics of the water level via two drainage experiments without an object inside of the tank. Second, we conduct a drainage experiment with an object inside of it, then leverage the calibrated forward model and the liquid level time series data to predict the shape of the object inside the tank with quantified uncertainty.
Our approach may be practically useful to infer the shape of an unknown object or porosity of packed particles (e.g., sand or gravel) inside of an opaque tank with access to liquid level measurements. 
\newline

\begin{center}
	\includegraphics[height=0.375\textwidth]{../tank_geometry/tank_w_bottle.pdf}
	\includegraphics[height=0.375\textwidth]{../toy_h_w_object.pdf}
\end{center}

\absbreak % unclear why this is needed


\end{abstract}
%%%%%%%%%%%%%%%%%%%%%%%%%%%



\rsbreak

%%%%%%%%%% Insert the texts which can accomdate on firstpage in the tag "fmtext" %%%%%

\section{Introduction}
Throughout engineering and the applied sciences, we encounter a liquid-holding tank that is draining via gravity-driven flow through a small orifice.
Mathematical models of the dynamics of the liquid level in a draining tank are useful for designing the geometry of the tank and orifice, predicting the emptying time, forecasting the outlet flow rate, controlling the liquid level via an input stream, and inferring the liquid level from the outlet flow rate \cite{d2021torricelli,seborg2016process,groetsch1993inverse,groetsch1999inverse}.

\begin{mytcbox}[label=box:waterclocks, breakable]{Ancient water clocks}
Interestingly, ancient societies (e.g. ancient Greece) exploited the empirically predictable dynamics of the water level in a draining tank to measure and display the passage of time.
Specifically, the outflow \emph{clepsydra}, Greek for ``water thief'', was an open-top container with a small hole near its bottom and graduated markings on the inside. 
Filled with water then allowed to drain, the elapsed time was indicated by the liquid level with respect to the markings on the inside. \cite{bedini1962compartmented,hwang2021historical,ritner2016oriental,hejun1987research,schomberg2018karnak,mills1982newton}
The preserved Karnak clepsydra from $\sim$1300 BC \cite{schomberg2018karnak} is an inverted truncated cone. Notably, this geometry does not provide a constant rate of decrease in the liquid level; perhaps, though, its wider top was intended to compensate for faster outflow at higher liquid levels. An inverse problem pertaining to an outflow clepsydra is: what container shape gives a constant rate of decrease in the liquid level as it drains?
(Such a clepsydra may be obtained via a solid of revolution about the vertical axis such that the radius is proportional to the quartic root of the height. \cite{mills1982newton,d2021torricelli})
\end{mytcbox}
%Draining tanks have been studied since ancient times, as evidenced by water clocks in ancient Egypt, Greece, India, and China.
%The water clock, or clepsydra (Greek for ''water thief''), of the outflow design consisted of an open-top container, filled with water at some reference time, with a small orifice for outflow near its bottom.

%The geometry of an ideal clepsydra would produce a constant rate of decrease in the liquid level. However, the geometry of e.g. the preserved Karnak clepsydra from $\sim$1300 BC \cite{schomberg2018karnak}, an inverted truncated cone, does not. Though, perhaps, its wider top was intended to compensate for the faster outflow when the liquid level is higher.

% Italian physicist and mathematician 
Evangelista Torricelli (1608-1647) made a fundamental observation for mathematical modeling the liquid level in a tank draining via gravity-driven flow through a small orifice: the velocity $v$ at which liquid flows out of the orifice is proportional to the square root of the height of liquid above the orifice, $\Delta h$, i.e. $v\propto \sqrt{\Delta h}$ \cite{mills1982newton}.
% TODO: check that he didn't know g!
Today, we recover Torricelli's observation from Daniel Bernoulli's (1700â€“1782) equation \cite{welty2020fundamentals}, a mechanical energy balance applied to the steady, plug flow of an incompressible, inviscid fluid through the orifice, with frictional forces neglected. This gives \emph{Torricelli's law}: $v=\sqrt{2 g \Delta h}$, with $g$ the acceleration due to gravity. \cite{d2021torricelli,teoman2022discharge}

Applying a mass balance and Torricelli's law to a tank draining of liquid via gravity-driven flow through a small orifice, we obtain a first-order, [generally] nonlinear differential equation governing the liquid level in the tank over time \cite{groetsch1993inverse,seborg2016process,debook}.
The geometry of the tank affects the dynamics of the liquid level through its cross-sectional area (parallel to the ground) as a function of height.
The cross-sectional area of the orifice theoretically gives the volumetric flow rate out of the tank from Torricelli's law. 
% TODO: a name for cross-sectional area parallel to the ground?
However, for the model to agree with the experimentally measured liquid level in a draining tank over time \cite{de2000pin,blasone2015discharge,wadhwa2021study,liu2008drainage}, a discharge coefficient, defined as the ratio of the observed outlet volumetric flow rate to that predicted by Torricelli's law and the area of the orifice \cite{hicks2014determining}, is introduced into the model. 
The discharge coefficient, typically $\approx$0.6,
accounts for frictional losses across the orifice, non-uniformity of the velocity profile, and the vena contracta of the liquid jet.
The latter phenomenon of narrowing, i.e. where the cross-sectional area of the liquid jet issuing from the orifice is smaller than the area of the orifice, owes to fluid streamlines inside the tank, near the orifice, not perpendicular to the orifice \cite{horsch2020simple}. 
%  and (ii) depends on the rheology of the fluid and the geometry of the orifice. 
\cite{teoman2022discharge,hicks2014determining,blasone2015discharge,lienhard1984velocity,wadhwa2021study}

% Note, Torricelli's law combined with kinematic equations on a packet of fluid ejected from the orifice of the tank give the trajectory of the liquid jet, too \cite{groetsch1999inverse}.

A draining tank is an intuitive, relatable physical system to mathematically model in an undergraduate course. 
More, experiments in the classroom to collect data to validate the model of the liquid level over time are accessible and illustrate the effectiveness of mathematical models.
\cite{farmer1992physical,driver1998torricelli,brady2009siphons,rother2024modelling,paldy1963apparatus,ivanov2014testing,williams2021vessel,pavesi2019investigating,planinvsivc2011holes,saleta2005experimental,lopac2015water,powell2012carrying}
Draining tanks provide undergraduate-friendly inverse problems \cite{groetsch1993inverse,neto2012introduction,tarantola2005inverse} as well, such as inferring the shape of the tank from the observed liquid level over time \cite{groetsch1993inverse,groetsch1999inverse}. 

\subsection{Our contribution}
In this article, we consider the following inverse problem pertaining to a tank draining of liquid
practically important:
interesting: infer a function. 


\section{Setup for tank drainage experiments} \label{sec:expt}
In our experimental setup, we (1) fill a small, open-top, plastic tank with water, to an initial level $h_0$ [cm], then (2) at time $t=0$ [s], allow the water to drain out through a small orifice in the side of the tank, near its bottom. 
We use an immersive, electrical-resistance-based liquid level strip to measure the water level in the tank over time, giving time series data $\{(t_i, h_{\text{obs}, i}) \}$. The tank may or may not have a heavy, solid, stationary object inside of it, displacing water and thus affecting the dynamics of emptying. Fig.~\ref{fig:photo_of_tank} shows a photo of an experiment where the tank does not have an object inside of it.

Ultimately, we conduct a set of three tank draining experiments. The first two [repeat] experiments concern the tank without the object, for the purpose of gathering data to calibrate then test a mathematical model of the dynamics of the water level in the tank. The third experiment concerns the tank with an object inside of it, for the purpose of indirectly gathering data about the shape of the object, for the shape reconstruction problem.

\begin{figure}[h!]
\begin{center}
	% \includegraphics[width=0.3\textwidth]{../tank_geometry/photo_of_tank.png}
	\caption{\textbf{Experimental setup.} 
	The water-holding tank is shaped as inverted, right, truncated cone with a rounded rectangle base and has a small hole in its side. In our experiments, we fill the tank with water, then allow the tank to drain via gravity-driven flow out of the small hole. An immersed liquid level strip measures the water level in the tank over time, giving time series data.
	}
	\label{fig:photo_of_tank}
\end{center}
\end{figure}

\paragraph{The tank geometry.} The water-holding tank is approximately an inverted, right, truncated cone with a rounded rectangle as its base. The cross-sectional area [parallel to the ground] of the tank as a function of height $h$ [cm] from its bottom base is:
\begin{equation}
	a(h) = \frac{h}{h_{\text{max}}}a_t + \left(1-\frac{h}{h_{\text{max}}}\right) a_b, \label{eq:a_of_h}
\end{equation}
with $h_{\text{max}}$ [cm] the height of the tank and $a_b$ [cm$^2$] and $a_t$ [cm$^2$] the area of the rounded rectangle forming the bottom and top, respectively, base of the tank.
The top of the tank is open to the atmosphere. 

\paragraph{The small orifice in the side of the tank.} The tank has a small, circular hole of radius $r_o$ [cm] in its side, whose center is a small height $h_o$ [cm] from the bottom base.
Thus, when the liquid level in the tank is larger than $h_o$, water flows out of this small orifice.
(When drilling the hole, we held the drill bit parallel to the floor.) 

\paragraph{The object [possibly] inside the tank.} We may place a heavy (denser than water), solid object inside the tank. Because the object is solid, it displaces water while in the tank. Because this object is heavy, it remains at rest, at the bottom of the tank, throughout the experiment. Let $\alpha(h)$ [cm$^2$] be the cross-sectional [parallel to the floor] area of this object as a function of height $h$.

\paragraph{The liquid level sensor.} We place an eTape\texttrademark\xspace liquid level strip vertically inside the tank to measure the water level in the tank over time. The liquid level sensor communicates with an Arduino microcontroller, allowing us to automatically collect the time series data and write it to a file. The liquid level strip functions by virtue of being compressed by the hydrostatic pressure of the water in which it immersed; its resistive output is inversely proportional to the water level. 
\cite{eTape}
We constructed a calibration curve with a resolution of 1 cm to map the resistive output of the level sensor (0-1023 integer values) to the liquid level in the tank [cm]. 
% what are the units of the reading of liquid level sensor

\section{The forward and measurement models}
The \emph{forward model} provides a prediction of the liquid level $h(t)$ [m] in our draining tank over time $t$ [s], given the following \emph{parameters}: shape of the tank $a(h)$, the shape of the object inside our tank $\alpha(h)$, the radius of the circular orifice $r_o$, the height $h_o$ of the orifice, the discharge coefficient $c$, and the initial liquid level $h_0$. 
Coupled with a probabilistic \emph{measurement model} characterizing the noise contaminating a measurement $(t_i, h_{\text{obs}, i})$ by our liquid level sensor, the forward model allows us to compute the \emph{likelihood function}. The likelihood function specifies the probability of observing a time series data set $\{(t_i, h_{\text{obs}, i})\}$ from our experiment conditioned upon proposed functions/values for the parameters $\alpha(h)$, $H$, $a_b$, $a_t$, $r_o$, $h_o$, $c$, and $h_0$. Thus, when any of these parameters are uncertain/unknown, the likelihood function quantifies the support that the time series data $\{(t_i, h_{\text{obs}, i})\}$ lend for each possible set of parameters.

\subsection{Forward model}
Suppose we fill our tank to an initial liquid height $h_0 \leq H$ [m], then at time $t=0$ [s] allow it drain through the orifice without further input of liquid. Fundamentally, the outflow is driven by gravity exerting a force on the water above the orifice, which causes a hydrostatic pressure in the water inside the tank at the entrance of the orifice. 
We wish to mathematically model the height of liquid in the tank as a function of time, $h=h(t)$, with $t$ [s] time. 

We assume the water at the top of the tank remains flat, allowed by a slow rate of discharge. We treat the water as incompressible (hence, constant density, $\rho$ [g/cm$^3$]) and inviscid. We do not attempt to explicitly model the flow streamlines inside the tank (as in Refs.~\cite{mathew2014numerical,sakri2017numerical}). 

\paragraph{Torricelli's law.}
Given the height of water in the tank is $h(t)$ [cm] at some time $t$, we model the velocity $v$ [cm/s] of the jet of water flowing out of the orifice with Torricelli's law \cite{d2021torricelli}:
\begin{equation}
	v\left(h(t) \right)=  \sqrt{2 g(h(t)-h_o)}, \label{eq:Torricelli}
\end{equation} where $g$ [cm/s$^2$] is the acceleration due to gravity. Torricelli's law follows from Bernoulli's equation \cite{welty2020fundamentals}, a mechanical energy balance on the flow through the orifice, treating (i) the flow as steady, plug, and absent of frictional forces and (ii) the water as inviscid and incompressible.
An intuitive explanation of Torricelli's law is as follows. 
Conceptually, over a small time interval during draining, a small slice of liquid at the very top of the tank is removed and, concomitantly, an equivalent mass $m$ [g] of liquid is ejected from the orifice.
Gravitational potential energy is converted to kinetic energy. 
Torricelli's law equates the loss in potential energy of the system, $m g(h-h_o)$, with the kinetic energy gained, $m v^2/2$ \cite{groetsch1993inverse,driver1998torricelli,williams2021vessel}. 

\paragraph{Volumetric flow rate out of the tank.} Given the height of water in the tank is $h(t)$ at time $t$, we apply Torricelli's law in eqn.~\ref{eq:Torricelli} and model the volumetric flow rate of water out of the tank as:
\begin{equation}
	c \pi r_o^2 \sqrt{2 g(h(t)-h_o)}, \label{eq:outletflow}
\end{equation}
with $c\in(0,1)$ the [dimensionless] discharge coefficient to account for the vena contracta in the liquid jet, non-plug flow through the orifice, and frictional losses as the water flows through the orifice. 
Note, $c=1$ assumes a liquid jet cross-sectional area equal to that of the orifice ($\pi r_o^2$), plug flow, and zero frictional losses.
Generally, the discharge coefficient depends on the rheology of the fluid, the geometry of the orifice, and, for laminar as opposed to turbulent flow, the Reynolds number of the flow \cite{teoman2022discharge}. 
\cite{horsch2020simple,teoman2022discharge,hicks2014determining,blasone2015discharge,lienhard1984velocity,wadhwa2021study}

\paragraph{Volume of water in the tank.} Given the height of water in the tank is $h(t)$ at time $t$, the volume $V$ of water inside the tank follows from the method of cross-sections in calculus \cite{debook}:
\begin{equation}
	V(h(t))=\int_0^{h(t)} \left(a(y) - \alpha(y) \right) dy, \label{eq:volume}
\end{equation}
where $a(y)-\alpha(y)$ is the cross-sectional area of water in the tank when the liquid level is $h=y$. Subtraction of the area of the object $\alpha(y)$ from the area of the tank $a(h)$ accounts for the displacement of water by the object inside the tank. 
(We neglect the volume of water displaced by the level strip.)

\paragraph{Mass balance to arrive at the forward model.} Application of the law of conservation of mass to the draining tank (the control volume) at time $t \geq 0$ equates the rate of deaccumulation of water in the tank [g/s] with the outflow rate [g/s] in expression \ref{eq:outletflow}:
\begin{equation}
	\overbrace{\diff{}{t} \Bigl( \rho V(h(t)) \Bigr )}^{\text{rate of accumulation}}= - \overbrace{\rho c \pi r_o^2 \sqrt{2 g(h(t)-h_o)}}^{\text{outflow rate}}
\end{equation}
Taking the derivative of $V(h(t))$ in eqn.~\ref{eq:volume} and using the chain rule \cite{debook} gives our forward model for $h(t)$:
%\begin{empheq}[box=\mybox]{align}
\begin{empheq}[box={\Garybox[forward model]}]{align}
& \left(a(h)-\alpha(h)\right) \diff{h}{t}= -c \pi r_o^2 \sqrt{2g (h(t)-h_o)}, \,\,\, t \geq 0 \label{eq:forward_model} \\
& h(0)=h_0, \nonumber
\end{empheq}
a [generally] nonlinear, first-order differential equation in $h(t)$ subject to an initial condition.
Given the tank and object geometry through $a(h)$ and $\alpha(h)$, the discharge coefficient $c$, the orifice radius and height $r_o$ and $h_o$, and initial height $h_0$, we may numerically solve the ODE in eqn.~\ref{eq:forward_model} (using e.g. \texttt{DifferentialEquations.jl} \cite{rackauckas2017differentialequations}) to predict the dynamics of the liquid level $h(t)$. 
I.e., this \emph{forward} model makes predictions of the system output $h(t)$ (an \emph{effect}) when given the parameters and initial condition (the \emph{cause} of the effect).

\vspace{-\baselineskip}
\subparagraph{A regime of model invalidity.} If the radius of the orifice $r_o$ is small, surface tension may prevent water from flowing out of the orifice when $h- h_o$ is small yet positive. In this regime, Torricelli's law and thus the forward model do not hold.

\paragraph{Input, output, and model parameters.} 
In the language of inverse problems \cite{groetsch1999inverse,waqar2023tutorial}, we refer to the object geometry $\alpha(h)$ as an \emph{input} to the system (a \emph{cause}) and the water level as a function of time $h(t)$ as the \emph{output} of the system (an \emph{effect}).
The initial water level $h_0$ is also an input.  
The \emph{model parameters} $\boldsymbol \theta \in \mathbb{R}^6$ characterize the geometry of the tank and the orifice and the rheology of water (embedded in $c$):
\begin{equation}
	\boldsymbol \theta := [h_{\text{max}}, a_b, a_t, r_o, h_o, c]. \label{eq:theta}
\end{equation}
(We omit $g$ from $\boldsymbol \theta$ because we treat it as a constant known with certainty.)

We parameterize the area of the object inside the tank as a function of height, $\alpha(h)$, with a list of $n+1$ discrete evaluations of $\alpha(h)$ on a uniform grid of points on its domain:
\begin{equation}
	\boldsymbol \alpha := [\alpha_0, \alpha_1, ... \alpha_n]
\end{equation}
where $\alpha_i :=\alpha(i h_{\text{max}}/n)$ for $i \in \{0, ..., n\}$. Then, we construct $\alpha(h)$ for $h\in [0, h_{\text{max}}]$ via linear interpolation of these values.

Hereafter, we write the forward model as \themodel to explicitly indicate the dependence of $h(t)$ on the initial liquid level $h_0$, the object geometry $\alpha(h)$, and the parameter vector $\boldsymbol \theta$. 

\subsection{Measurement model}
Suppose at time $t$ our liquid level sensor measures the height of liquid in the tank, giving us a data point $(t, h_{\text{obs}})$ (obs for ``observation''). 
To capture the [unobservable] noise corrupting the measurement, we treat the measured liquid level $h_{\text{obs}}$ as a realization of a random variable $H_{\text{obs}}$:
\begin{equation}
	H_{\text{obs}} = \themodelnomath + \Psi,
\end{equation}
with the random variable $\Psi \sim \mathcal{N}(0, \sigma^2)$ the unobservable noise. 
We model the noise as additive to the model prediction \themodel from eqn.~\ref{eq:forward_model} and, among multiple measurements, independent and identically-distributed (IID) as a zero-mean Gaussian with variance $\sigma^2$. 
Therefore, the probability distribution governing the measured liquid level is a Gaussian with mean equal to the model prediction \themodel and variance $\sigma^2$:
\begin{equation}
	H_{\text{obs}} \mid h_0, \boldsymbol \alpha, \boldsymbol  \theta, \sigma^2 \sim \mathcal{N}(\themodelnomath, \sigma^2). \label{eq:H_obs_distn}
\end{equation} Importantly, the probability distribution of $H_{\text{obs}}$ is conditioned upon the initial water level, the object geometry, the parameter vector, and the variance of the noise.
% Sources of this noise are: imprecision of the liquid level strip, our calibration curve for the liquid level strip, vibrations

% TODO: plot residuals
% TODO expand 

Note, our measurement model neglects the possibility of model discrepancy \cite{brynjarsdottir2014learning,kennedy2001bayesian}, a difference between the true dynamics of the liquid level in the tank and the model $h(t; h_0^*,  \boldsymbol \alpha^*, \boldsymbol \theta^*)$ with the true/best-fit (indicated by $*$) initial water level, object geometry, and parameters. In other words, we assume our forward model is capable of capturing the true liquid level dynamics in the tank without bias.


\subsection{Likelihood function}
The likelihood is the probability density of observing time series data \thedata given the initial water level $h_0$, object geometry $\boldsymbol \alpha$, model parameters $\boldsymbol \theta$, and measurement noise variance $\sigma^2$. Once the data are collected, the likelihood is instead viewed as a function of $h_0$, $\boldsymbol \alpha$, $\boldsymbol \theta$, and $\sigma^2$, quantifying the support that the data lend for those proposed values. Based on eqn.~\ref{eq:H_obs_distn} and the IID assumption, the likelihood function is:
\begin{equation}
 \pi_{\text{like}}(\thedatanomath \mid h_0,\boldsymbol  \alpha, \boldsymbol \theta, \sigma^2 ) = \prod_{i=1}^N \frac{1}{\sqrt{2\pi\sigma^2}} \exp \left[-\frac{1}{2}\left(\frac{h_{\text{obs}, i} - h(t_i; h_0, \boldsymbol\alpha, \boldsymbol\theta)}{\sigma} \right)^2 \right]. \label{eq:like}
\end{equation}

\section{Bayesian statistical inversion}
In phase I, our objective is to calibrate the forward and measurement models using length-measurements and tank drainage time series data \thedata \emph{without} a solid object inside the tank (so $\boldsymbol \alpha=\mathbf{0}$ is known).
Model calibration is an inverse problem of parameter inference; we wish to leverage data to infer the parameter vector $\boldsymbol \theta$ and the measurement noise variance $\sigma^2$. 
In phase II, our objective is to leverage the calibrated forward and measurement model to infer the shape of a heavy, solid object inside of the tank---i.e., infer $\boldsymbol \alpha$---from tank drainage data \thedata when an object resides in the tank. This constitutes an inverse problem of reconstruction. 

We sequentially tackle both of these inverse problems with Bayesian statistical inversion \cite{calvetti2018inverse,waqar2023tutorial,kaipio2006statistical} to incorporate prior information and quantify uncertainty in the solution. 
Fundamentally, both inverse problems are united in the sense that we treat the initial water level, object geometry, parameter vector, and measurement noise variance as random variables $H_0$, $\boldsymbol A$, $\boldsymbol \Theta$, and $\Sigma^2$ and model their probability distributions. The two inverse problems simply differ in the degree of prior knowledge we have about $H_0$, $\boldsymbol A$, $\boldsymbol \Theta$, and $\Sigma^2$.

Bayesian statistical inversion \cite{calvetti2018inverse,waqar2023tutorial,kaipio2006statistical}  follows three stages:

\vspace{-\baselineskip}
\paragraph{Stage 1: express our prior beliefs and information about the unknowns via a prior distribution.}
First, we specify a prior probability density $\pi_{\text{pr}}(h_0, \boldsymbol \theta, \sigma^2)$ expressing our beliefs about the values of the initial water level $h_0$, the parameter vector $\boldsymbol \theta$, and the measurement noise variance $\sigma^2$ \emph{before} we collect time series data from a setup tank-drainage experiment.
Our beliefs encoded into the prior may be strongly grounded in information/data/measurements, but also have some degree of subjectivity.
The prior can range from diffuse (e.g. a uniform distribution) to informative (e.g. a Gaussian with a small variance). \cite{van2021bayesian}

\vspace{-\baselineskip}
\paragraph{Stage 2: conduct an experiment to gather data containing information about the unknowns.}
Next, we conduct a tank-drainage experiment (with or without a solid object inside of it, see Sec.~\ref{sec:expt}) to gather time series data characterizing the dynamics of the liquid level, \thedata. When this data are considered against the forward model, the data provide new information about the initial water level $H_0$, parameter vector $\boldsymbol \Theta$, and measurement noise variance $\Sigma^2$.

\vspace{-\baselineskip}
\paragraph{Stage 3: update the prior to a posterior distribution in light of the data.}
Finally, we update the prior to a posterior probability density $\pi_{\text{post}}(h_0, \boldsymbol \theta, \sigma^2 \mid \thedatanomath)$ in light of the data \thedata we collected. 
The posterior density follows from the likelihood function in eqn.~\ref{eq:like} and prior density via Bayes's theorem \cite{van2021bayesian,calvetti2018inverse}:
\begin{equation}
	\pi_{\text{post}}(h_0, \boldsymbol \theta, \sigma^2 \mid \thedatanomath) = \frac{
	\pi_{\text{like}}(\thedatanomath \mid h_0, \boldsymbol \theta, \sigma^2 ) 
	\pi_{\text{pr}}(h_0, \boldsymbol \theta, \sigma^2)
	}{
	\pi_{\text{ev}}(\thedatanomath) 
	}, \label{eq:post}
\end{equation} where the denominator, the \emph{evidence}, is the marginal likelihood:
\begin{equation}
    \pi_{\text{ev}}(\thedatanomath) = \int_0^\infty \int_{\mathbb{R}^{n+7}} \int_0^\infty \pi_{\text{like}}(\thedatanomath \mid h_0 \boldsymbol \theta, \sigma^2)  
	\pi_{\text{pr}}(h_0, \boldsymbol \theta, \sigma^2) dh_0 d \boldsymbol\theta d\sigma^2 \label{eq:ev}
\end{equation}
that can in principle be computed from the likelihood and prior in the numerator. 

\paragraph{The posterior distribution is the raw solution to the inverse problem.}
The posterior probability density $\pi_{\text{post}}(h_0, \boldsymbol \theta, \sigma^2 \mid \thedatanomath)$ is the raw, uncertainty-quantifying solution to the inverse problem.
The posterior expresses the state of our knowledge about the initial water level $h_0$, parameter vector $\boldsymbol \theta$, and measurement noise variance $\sigma^2$ in light of the experimental tank drainage data \thedata when compared with the forward and measurement models. 
Assuming the forward and measurement models and prior assumptions hold, $h_0$, $\boldsymbol \theta$, and $\sigma^2$ plausibly belong to the region of $(h_0, \boldsymbol \theta, \sigma^2)$ space containing the bulk of the posterior density, and the spread of the posterior over this space quantifies our uncertainty about them.
The posterior distribution constitutes the solution to e.g. (i) a model calibration problem, where we primarily seek to infer the discharge coefficient $C$ and measurement noise variance $\Sigma^2$, (ii) a time reversal problem, where we primarily seek to infer the initial water level $H_0$, or (iii) a reconstruction problem, where we primarily seek to infer the area of the object inside the tank described by $\mathbf{A}$. 
From the posterior, we may derive a credible interval for each varaible. E.g., the 95\% equal-tailed credible interval for a parameter contains 95\% of the posterior density with equal-area tails omitted on both sides. 
Considering $\pi_{\text{post}}(h_0, \boldsymbol\theta)$ (with $\sigma^2$ marginalized out) in conjunction with the forward model, we can make probabilistic predictions, such as ``what is the probability distribution of emptying times for a draining tank with initial measured liquid level $h_{0, \text{obs}}$?''.

\paragraph{Sampling from the posterior distribution.} We resort to Markov chain Monte Carlo (MCMC) simulations \cite{robert1999monte} to obtain samples from the posterior density $\pi_{\text{post}}(h_0, \boldsymbol \theta, \sigma^2 \mid \thedatanomath)$ in eqn.~\ref{eq:post}. Advantageously, MCMC samplers do not require us to compute the evidence $\pi_{\text{ev}}(\thedatanomath)$ in eqn.~\ref{eq:ev}, a high-dimensional integral. Specifically, we employ the No-U-Turn Sampler (NUTS) \cite{hoffman2014no} implemented in \texttt{Turing.jl} \cite{ge2018turing}. From the samples of parameter vectors from the posterior, we may draw empirical posterior distributions (histograms) and compute credible intervals.


\section{Results}
We now use Bayesian statistical inversion to:
(1) calibrate our forward and measurement model using (a) length-measurements of the tank and orifice geometry and (b) water level time series data from a tank drainage experiment without an object, then
(2) exploit our calibrated model to infer the shape of a solid, heavy object inside of our tank using water level time series data from a tank drainage experiment. 

\subsection{Phase I: Bayesian calibration and testing of the dynamic model of the liquid level}
Our objective in phase I is to calibrate our forward and measurement models in eqn.~\ref{eq:forward_model} and \ref{eq:H_obs_distn}.
To do so, we (a) make length-measurements of our tank and orifice geometry and (b) collect water level time series data from a tank drainage experiment \emph{without} an object inside the tank (so, $\boldsymbol \alpha = \mathbf{0}$).

The product of our model calibration phase is the posterior distribution of the model parameters $\boldsymbol \Theta$ and measurement noise variance $\Sigma^2$, $\pi_{\text{post}}(\boldsymbol \theta, \sigma^2 \mid \thedatanomath)$.
The key idea is that our length-measurements of the tank and orifice geometry and water level time series data from a drainage experiment in a tank without an object provide information about the geometry of the tank and orifice ($A_t$, $A_b$, $H_{\text{max}}$, $H_o$, $R_o$), the discharge coefficient $C$, and the measurement noise variance $\Sigma^2$. Hopefully, the informative posterior distributions of these parameters we obtain from this model calibration phase will allow us to accuracy solve the reconstruction problem in phase II. 
In phase I, we also conduct a replicate experiment for testing the calibrated model. 
% Since we directly measured the other parameters in $\theta$, the two primary unknowns for our model calibration phase are the discharge coefficient $C$ and noise variance $\Sigma^2$. 

\subsubsection{Experimental setup}
We set up a tank draining experiment (see Sec.~\ref{sec:expt}) with an initial water level (measured by the level strip) $h_{0, \text{obs}}=26.54$\,cm. 
Certainly, no heavy, solid object resides in the tank. 
See Fig.~\ref{fig:naked_tank}.

\subsubsection{Prior distributions} Below, we specify the prior probability density $\pi_{\text{pr}}(\boldsymbol \theta, \sigma^2)$ governing the parameter vector $\boldsymbol \Theta$ in eqn.~\ref{eq:theta} and variance in the level sensor noise $\Sigma^2$.
Together with the forward model in eqn.~\ref{eq:forward_model}, $\pi_{\text{pr}}(\boldsymbol \theta, \sigma^2)$ encodes a prior distribution over water level trajectories in the tank, $h(t; \boldsymbol \Theta)$. Fig~\ref{fig:prior_train} shows functions $h(t; \boldsymbol \theta)$ with $\theta$ sampled from the prior distribution.


\vspace{-\baselineskip}
\paragraph{Geometry of the tank, orifice, and object inside the tank.} 
We impose the informative prior distributions on the tank and orifice geometry, based on length-measurements and the reported drill bit diameter. 
Because no solid object resides in the tank, $\boldsymbol \alpha=\mathbf{0}$ with certainty (technically, a Dirac delta prior density).

We use a measuring tape to make length-measurements of the dimensions of the tank and the height of the orifice. 
Our estimates for the area of the rounded rectangle forming the top and bottom of the tank are $a_{t, \text{obs}}=129.9$\,cm and $a_{b, \text{obs}}=103.0$\,cm, and we measure the height of the tank as $h_{\text{max, obs}}=28.6$\,cm. 
We measure the height of the orifice in the side of the tank as $h_{o, \text{obs}}=0.9$\,cm. 
We admit uncertainty about our measurements by treating $A_t$, $A_b$, $H_{\text{max}}$, and $H_o$ as random variables (hence, capitalized). We impose informative prior distributions on each, centered at our measurements:
\begin{align}
A_t &\sim \mathcal{N}(a_{t, \text{obs}}, \sigma_\ell^2/2) \label{eq:A_t_prior} \\
A_b &\sim \mathcal{N}(a_{b, \text{obs}}, \sigma_\ell^2/2) \\
H_{\text{max}} &\sim \mathcal{N}(h_{\text{max}, \text{obs}}, \sigma_\ell^2) \\
H_o &\sim \mathcal{N}(h_{o, \text{obs}}, \sigma_\ell^2),
\end{align}
where $\sigma_\ell=0.1$\,cm is the assumed standard deviation of our length measurements based on the markings on our measurement tape. The factor of $1/2$ in the variance for $A_t$ and $A_b$ arises from the variance of a product of Gaussian random variables \cite{bromiley2003products}.

For the radius of the orifice, we impose the informative prior distribution:
\begin{equation}
r_o \sim \mathcal{N}(r_{o, \text{obs}}, \sigma_d^2), \label{eq:R_o_prior}
\end{equation}
with $r_{o, \text{obs}}=0.1$\,cm based on the manufacturer-reported diameter (5/64\,in) of the drill bit we used to drill the hole in the tank. The standard deviation of $\sigma_d= 0.001$\,cm accounts for uncertainty in the drill bit radius and its translation into an orifice radius.

\vspace{-\baselineskip}
\paragraph{Discharge coefficient.} 
Finally, we impose a weakly informative prior distribution on the discharge coefficient
\begin{equation}
	C \sim \mathcal{N}(0.65, 0.25),
\end{equation} whose mean is informed by the reported discharge coefficient for water flow through a round orifice \cite{hicks2014determining}. 

\vspace{-\baselineskip}
\paragraph{Variance of noise in level sensor.}  
We impose a uniform prior on the standard deviation of the noise in our liquid level sensor:
\begin{equation}
\Sigma \sim \mathcal{U}(0\,\text{cm}, 0.5\,\text{cm}),
\end{equation} whose generous upper bound is informed by our experience in calibrating the liquid level strip. 

\vspace{-\baselineskip}
\paragraph{Initial water level.} 
To admit uncertainty in the initial water level as measured by the level sensor, we impose an informative prior distribution on the initial water level:
\begin{equation}
	H_0 \sim \mathcal{N}(h_{0, \text{obs}}, \sigma^2),
\end{equation} where $\sigma^2$ is the [unknown] variance of the noise from the level sensor in our measurement model.

\subsubsection{Water level time series data from a tank-drainage experiment} At time $t:=0$, we allow our tank to drain of water through the small orifice in its side. The liquid level sensor records the liquid level over time. The resulting water level time series data \thedata are shown in Fig.~\ref{fig:posterior_train}.

\subsubsection{Posterior distribution}
Given our prior probability density $\pi_{\text{pr}}(\boldsymbol \theta, \sigma^2)$ and data \thedata from which we construct the likelihood function in eqn.~\ref{eq:like}, the posterior distribution $\pi_{\text{post}}(\boldsymbol \theta, \sigma^2 \mid \thedatanomath)$ follows from Bayes's theorem in eqn.~\ref{eq:post}. 
We employ NUTS to obtain samples of $\boldsymbol \theta$ and $\sigma^2$ from our posterior. 

Fig.~\ref{fig:posterior_train_theta} shows the [marginal] empirical posterior probability distributions (histograms) of the parameters and noise along with their 80\% equal-tailed credible interval. For the variables we measure with the measuring tape, the credible interval is centered at the measurement. The measured initial water level, however, falls outside of the credible interval; a higher initial water level than measured is consistent with the rest of the time series data \thedata. Similarly, the mean posterior height of the orifice is slightly lower than our measurement. 
The main product of our model calibration phase is the empirical posterior distribution of the measurement noise variance $\Sigma^2$ and discharge coefficient $C$. 
The Gaussian distributions of best fit describing their posterior distribution are
\begin{align}
C \mid \thedatanomath & \sim \mathcal{N}(0.67, 0.01) \\
\Sigma \mid \thedatanomath & \sim \mathcal{N}(0.33, 0.05).
\end{align}
The information that the data from this tank-draining experiment provided about $C$ and $\Sigma$ will be useful for the reconstruction inverse problem of inferring the shape of an object inside the tank from water level time series data. (We assume the object does not affect the discharge coefficient nor noise in the liquid level sensor.)

\paragraph{Posterior predictive check.} As a posterior predictive check, we plot water level trajectories $h(t; \boldsymbol \theta)$ with $\boldsymbol \theta$ sampled from the posterior distribution, in Fig.~\ref{fig:posterior_train}. 
The posterior models are in reasonable agreement with the measured water levels over time. The mean absolute residual between the measured liquid level and the posterior prediction is 0.26\,cm.

\begin{figure}[h!]
    \centering
        \begin{subfigure}[b]{0.3\textwidth}
    	\includegraphics[width=\textwidth]{../tank_geometry/naked_tank.pdf}
	\caption{Experimental setup} \label{fig:naked_tank}
    \end{subfigure}
    
     \begin{subfigure}[b]{0.49\textwidth}
    	\includegraphics[width=\textwidth]{../prior_train.pdf}
	\caption{Prior dist'n of $h(t; \boldsymbol \Theta)$} \label{fig:prior_train}
    \end{subfigure}
     \begin{subfigure}[b]{0.49\textwidth}
    	\includegraphics[width=\textwidth]{../posterior_train.pdf}
	\caption{Data $\{(t_i, h_i)\}$ and posterior dist'n of $h(t; \boldsymbol \Theta)$} \label{fig:posterior_train}
    \end{subfigure}
    
     \begin{subfigure}[b]{0.85\textwidth}
    	\includegraphics[width=\textwidth]{../posterior_train_theta.pdf}
	\caption{Posterior dist'n of $\boldsymbol \Theta$} \label{fig:posterior_train_theta}
    \end{subfigure}
    
    \caption{
      \textbf{Model calibration.}
      (a) In the experimental setup, we fill our empty tank to an initial water level then, at $t=0$, allow it to drain through the orifice in its side.
      (b) Samples (100) of water level trajectories $h(t; \boldsymbol \theta)$ with $\boldsymbol \theta$ sampled from the prior probability density along with the measured initial water level.
      (c) Time series data from the tank drainage experiment and samples of water level trajectories $h(t; \boldsymbol \theta)$ with $\boldsymbol \theta$ sampled from the posterior probability density.
      (d) The empirical [marginal] posterior distributions of model parameters, constituting the product of the model calibration phase.
      }
\end{figure}

\subsubsection{A test experiment}
Before moving onto the reconstruction problem, we test our calibrated forward model (eqn.~\ref{eq:forward_model} together with the empirical posterior distributions of $A_t$, $A_b$, $H_{\text{max}}$, $R_o$, $H_o$, $C$, and $\Sigma$ in Fig.~\ref{fig:poster_train_theta}) for its ability to predict the dynamics of the liquid level in our tank in a replicate experiment.

We conduct a new, replicate tank-draining experiment (also without an object inside) with measured initial water level $h_{0, \text{obs}}=26.49$. 
We employ the posterior distribution of $\theta$ together with $H_0\sim \mathcal{N}(h_{0, \text{obs}}, \sigma^2)$ to sample liquid level trajectories $h(t; h_0, \boldsymbol \theta)$ predicted by the calibrated forward model. 
Fig.~\ref{eq:test} compares the liquid level time series data collected from the replicate experiment, \thedata, with the trajectories predicted by the calibrated model. We observe good agreement between the predictions by the calibrated model and the experimental data; the mean absolute residual is 0.28\,cm. (Just for kicks, we show the distribution of predicted tank-emptying times as well.)

\begin{figure}[h!]
    \centering
    	\includegraphics[width=0.5\textwidth]{../test.pdf}
    \caption{
      \textbf{Testing the calibrated forward model.}
      In a replicate tank-draining experiment without an object, we show (top) the predicted distribution of emptying times and (bottom) 100 samples of the liquid level trajectory predicted by the calibrated forward model together with the liquid level time series data. Besides the measured initial liquid level, the time series data was held out from the model predictions and thus serves as test data.
      } \label{fig:test}
\end{figure}

\subsection{Phase II: Bayesian inference of the shape of an object inside the tank}

\begin{figure}[h!]
    \centering
        \begin{subfigure}[b]{0.3\textwidth}
    	\includegraphics[width=\textwidth]{../tank_geometry/tank_w_bottle.pdf}
	\caption{Experimental setup} \label{fig:tank_w_bottle}
    \end{subfigure}
     \begin{subfigure}[b]{0.49\textwidth}
    	\includegraphics[width=\textwidth]{../posterior_object.pdf}
	\caption{Data $\{(t_i, h_i)\}$ and posterior dist'n of $h(t)$} \label{fig:posterior_object}
    \end{subfigure}
    
     \begin{subfigure}[b]{0.49\textwidth}
    	\includegraphics[width=\textwidth]{../prior_area.pdf}
	\caption{Prior dist'n of $\alpha(h)$} \label{fig:prior_area.pdf}
    \end{subfigure}
       \begin{subfigure}[b]{0.49\textwidth}
    	\includegraphics[width=\textwidth]{../posterior_area.pdf}
	\caption{Posterior dist'n of $\alpha(h)$} \label{fig:posterior_area.pdf}
    \end{subfigure}
    
  
    \caption{
      \textbf{Inferring the shape of the object in the tank.}
      }
\end{figure}

\section{Conclusions and Discussion}

Calibrate first. then can infer shape.

Rocks inside tank. infer type of rock, coupled with packing. Popcorn polymer.

Surface tension dominates keeping the liquid from exiting. Then Torricelli's law not valid. Liquid stops emptyhing slightly above the hole. 

basis functions for a(h), instead of point by point, but prior harder to interpret.

Mariotte's bottle \cite{kirevs2006mariotte}

\enlargethispage{20pt}

\ack{GF acknowledges ARMI for funding.}


%%%%%%%%%% Insert bibliography here %%%%%%%%%%%%%%

\vskip2pc


\bibliographystyle{RS} %%%% .BST file

\bibliography{refs} %%%%% .Bib file

\end{document}
